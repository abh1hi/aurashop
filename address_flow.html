<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Flow Diagram</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
        h1 { color: #333; }
        .mermaid { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Address Flow Documentation</h1>
    <p>This diagram illustrates the process of adding a new address.</p>
    
    <div class="mermaid">
sequenceDiagram
    participant User
    participant ProfilePage (UI)
    participant ProfilePage.js (Logic)
    participant useUser (Composable)
    participant Firestore (DB)

    User->>ProfilePage (UI): Clicks "Add New Address"
    ProfilePage (UI)->>ProfilePage.js (Logic): showAddAddress = true
    ProfilePage (UI)-->>User: Shows Address Form

    User->>ProfilePage (UI): Enters Label, Phone, Address
    User->>ProfilePage (UI): Clicks "Save Address"
    ProfilePage (UI)->>ProfilePage.js (Logic): handleSaveAddress()

    alt Validation Fails
        ProfilePage.js (Logic)-->>ProfilePage (UI): Show Toast "Please fill all fields"
    else Validation Passes
        ProfilePage.js (Logic)->>useUser (Composable): addAddress(newAddress)
        
        useUser (Composable)->>useUser (Composable): Generate ID (Date.now())
        useUser (Composable)->>Firestore (DB): updateDoc(uid, { addresses: arrayUnion(newAddress) })
        Firestore (DB)-->>useUser (Composable): Success
        
        useUser (Composable)->>useUser (Composable): Update local userProfile state
        useUser (Composable)-->>ProfilePage.js (Logic): Success
        
        ProfilePage.js (Logic)->>ProfilePage (UI): Show Toast "Address added"
        ProfilePage.js (Logic)->>ProfilePage (UI): Reset Form & Close (showAddAddress = false)
        ProfilePage (UI)-->>User: Updates Address List
    end
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</body>
</html>
